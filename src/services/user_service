from supabase_client import supabase
from typing import Tuple, Optional

def signup_user(email: str, password: str, name: str) -> Tuple[bool, Optional[str]]:
    try:
        result = supabase.auth.sign_up({
            "email": email,
            "password": password
        })

        if result.get("error"):
            return False, result["error"]["message"]

        user = result["user"]

        # âœ… Insert into custom users table
        supabase.table("users").insert({
            "user_id": user["id"],  # UUID from auth.users
            "name": name,
            "email": email  # optional, for easier lookup
        }).execute()

def login_user(email: str, password: str) -> Tuple[Optional[str], Optional[str]]:
    try:
        result = supabase.auth.sign_in_with_password({
            "email": email,
            "password": password
        })

        if result.get("error"):
            return None, result["error"]["message"]

        return email, None
    except Exception as e:
        return None, str(e)
